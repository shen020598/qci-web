---
import { Image } from 'astro:assets';
import { t, localePath } from '../utils/i18n';

const lang = Astro.props.language || 'en';
const translations = t(lang);
const navTranslations = translations.navbar;

const currentPath = Astro.url.pathname;
// Extract language from path
const pathSegments = currentPath.split('/').filter(Boolean);
const currentLang = (pathSegments[0] === 'en' || pathSegments[0] === 'zh' || pathSegments[0] === 'th')
  ? pathSegments[0]
  : 'en';

// Map language codes to display names
const langDisplay = {
  'en': 'EN',
  'zh': '中文',
  'th': 'ไทย'
};

const displayLang = langDisplay[currentLang];
---

<header class="bg-primary backdrop-blur-md relative z-50">
  <div class="mx-auto px-6 md:px-12 py-8 flex items-center justify-between">
    <!-- Logo -->
    <a href={localePath('/', lang)} class="flex items-center gap-3 pr-10 flex-2">
      <Image
        src={import('../assets/qci-logo-main.png')}
        alt="Quality Coils Industries logo"
        class="w-20 h-20 object-contain"
        loading="eager"
        width={80}
        height={80}
      />
      <span
        class="font-semibold text-2xl md:text-2xl text-text-primary font-poppins"
      >
        Quality Coil Industries
      </span>
    </a>

    <!-- Desktop Nav -->
    <nav
      class="hidden md:flex items-center gap-6 font-bold text-xl text-black flex-3 md:items-end md:justify-end"
    >
      <a
        href={localePath('/', lang)}
        class="hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
      >
        {navTranslations.home}
      </a>

      <!-- About Dropdown -->
      <div class="relative group">
        <a
          href={localePath('/about', lang)}
          class="flex items-center gap-1 hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
        >
          {navTranslations.about} <span class="text-sm ml-1">▼</span>
        </a>

        <!-- hover bridge -->
        <div class="absolute top-full left-0 w-full h-3"></div>

        <!-- dropdown -->
        <div class="absolute left-0 top-full hidden group-hover:block z-50">
          <div class="bg-stone-100 rounded shadow-lg w-40">
            <a
              href={localePath('/people', lang)}
              class="block px-4 py-4 rounded hover:bg-stone-100 hover:text-secondary font-poppins text-text-primary"
            >
              {navTranslations.people}
            </a>
          </div>
        </div>
      </div>

      <a
        href={localePath('/products', lang)}
        class="hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
        >{navTranslations.products}</a
      >
      <a
        href={localePath('/machinery', lang)}
        class="hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
        >{navTranslations.machinery}</a
      >
      <a
        href={localePath('/careers', lang)}
        class="hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
        >{navTranslations.careers}</a
      >
      <a
        href={localePath('/contact', lang)}
        class="hover:text-secondary transition-colors duration-300 font-poppins text-text-primary font-bold"
        >{navTranslations.contact}</a
      >
    </nav>

    <!-- Language Selector -->
    <div class="flex-2 items-end justify-end flex flex">
      <div class="relative group ml-4 bg-green-700 px-4 py-2 rounded w-fit">
        <button
          id="languageBtn"
          class="font-bold text-white text-xl flex items-center"
        >
          {displayLang} <span class="text-sm ml-2">▼</span>
        </button>

        <!-- bridge -->
        <div class="absolute top-full right-0 w-full h-3"></div>

        <!-- dropdown -->
        <div
          id="languageMenu"
          class="absolute right-0 top-full hidden group-hover:block z-50 rounded"
        >
          <div class="bg-stone-200 rounded shadow-lg w-32">
            <a
              href="/en"
              class="block px-4 py-2 hover:bg-stone-300 font-poppins text-text-primary text-xl"
              >EN</a
            >
            <a
              href="/zh"
              class="block px-4 py-2 hover:bg-stone-300 font-poppins text-text-primary text-xl"
              >中文</a
            >
            <a
              href="/th"
              class="block px-4 py-2 hover:bg-stone-300 font-poppins text-text-primary text-xl"
              >ไทย</a
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Right Side -->
    <div
      class="md:hidden rounded bg-green-700 flex items-center gap- px-4 py-2 ml-4"
    >
      <!-- Hamburger -->
      <button id="menuBtn" class="text-xl text-white"> ☰ </button>
    </div>
  </div>
</header>

<!-- Mobile Drawer -->
<div
  id="mobileMenu"
  class="fixed top-0 right-[-100%] w-1/2 h-full bg-white shadow-lg z-50 transition-all duration-300 font-poppins text-text-primary font-bold md:hidden"
>
  <div class="p-6 flex justify-between items-center flex justify-end">
    <button id="closeBtn" class="text-2xl">✕</button>
  </div>

  <nav class="flex flex-col gap-6 p-6 font-bold text-lg">
    <a href={localePath('/', lang)}>{navTranslations.home}</a>
    <a href={localePath('/about', lang)}>{navTranslations.about}</a>
    <a href={localePath('/about/people', lang)} class="ml-4 text-base">{navTranslations.people}</a>
    <a href={localePath('/products', lang)}>{navTranslations.products}</a>
    <a href={localePath('/machinery', lang)}>{navTranslations.machinery}</a>
    <a href={localePath('/careers', lang)}>{navTranslations.careers}</a>
    <a href={localePath('/contact', lang)}>{navTranslations.contact}</a>
  </nav>
</div>

<script>
  const languageBtn = document.getElementById("languageBtn");
  const languageMenu = document.getElementById("languageMenu");
  const btn = document.getElementById("menuBtn");
  const close = document.getElementById("closeBtn");
  const menu = document.getElementById("mobileMenu");

  languageBtn?.addEventListener("click", () => {
    if (!languageMenu) return;
    if (languageMenu.style.display === "block") {
      languageMenu.style.display = "none";
    } else {
      languageMenu.style.display = "block";
    }
  });

  btn?.addEventListener("click", () => {
    if (!menu) return;
    menu.style.right = "0";
  });

  close?.addEventListener("click", () => {
    if (!menu) return;
    menu.style.right = "-100%";
  });
</script>
