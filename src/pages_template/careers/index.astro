---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import { Image } from 'astro:assets';
import { t } from "../../utils/i18n";

const lang = Astro.props.language || "en";
const translations = t(lang).careers;
---

<BaseLayout 
    title={translations.meta.title}
    description={translations.meta.description}
>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <Navbar />
    <main>
    <section class="relative w-full overflow-hidden">
        <!-- Background Image -->
        <div
            class="relative h-[320px] md:h-[500px] lg:h-[600px] 2xl:px-100 bg-[#edf7f7]"
        >
            <Image
                src={import('../../assets/careers/career-head-bg.jpg')}
                alt={translations.hero.bgAlt}
                class="w-full h-full object-cover"
                loading="eager"
                fetchpriority={"high"}
                width={854}
                height={390}
            />

            <!-- Overlay -->
            <div class="absolute inset-0 bg-black/10"></div>

            <!-- Center Content -->
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center relative">
                    <!-- TITLE PANEL (solid background) -->
                    <div class="bg-white px-12 md:px-20 py-10 shadow-lg">
                        <h2
                            class="text-4xl md:text-8xl font-bold text-[#2b2623] leading-tight"
                            set:html={translations.hero.heading}
                        >
                        </h2>
                    </div>

                    <!-- BUTTON (slightly overlapping panel) -->
                    <a
                        href="#positions"
                        class="inline-block -mt-10 text-2xl bg-[#1f1f1f] text-white px-8 py-3 font-semibold shadow hover:opacity-90 transition"
                        aria-label={translations.hero.buttonAria}
                    >
                        {translations.hero.button}
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section class="bg-primary py-20">
        <div class="relative max-w-9xl mx-auto px-6">
            <!-- TWO ROWS -->
            <div class="flex flex-col gap-y-16 text-[#2b2623]">
                <!-- FIRST ROW -->
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <!-- Image -->
                    <div class="flex-1 flex justify-center md:justify-center">
                        <Image
                            src={import('../../assets/careers/careers-1.jpg')}
                            alt={translations.intro.image1Alt}
                            class="w-40 md:w-45 object-cover shadow"
                            loading="eager"
                            width={180}
                            height={180}
                        />
                    </div>

                    <!-- Divider -->
                    <div class="hidden md:block w-[2px] h-80 bg-[#2b2623]/20">
                    </div>

                    <!-- Text -->
                    <p
                        class="flex-1 text-lg md:text-2xl leading-relaxed text-center md:text-left text-text-primary"
                    >
                        {translations.intro.text1}
                    </p>
                </div>

                <!-- SECOND ROW -->
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <!-- Text -->
                    <p
                        class="flex-1 text-lg md:text-2xl leading-relaxed text-center md:text-right"
                    >
                        {translations.intro.text2}
                    </p>

                    <!-- Divider -->
                    <div class="hidden md:block w-[2px] h-80 bg-[#2b2623]/20">
                    </div>

                    <!-- Image -->
                    <div class="flex-1 flex justify-center md:justify-center">
                        <Image
                            src={import('../../assets/careers/careers-2.jpg')}
                            alt={translations.intro.image2Alt}
                            class="w-40 md:w-45 object-cover shadow"
                            loading="lazy"
                            width={180}
                            height={180}
                        />
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="bg-primary py-20">
        <div class="max-w-9xl mx-auto px-6 text-center">
            <!-- TITLE -->
            <h2 class="text-5xl md:text-7xl font-bold mb-4 text-[#2b2623]">
                {translations.whatWeOffer.heading}
            </h2>

            <p
                class="max-w-5xl mx-auto mb-16 text-[#2b2623] font-semibold text-3xl"
            >
                {translations.whatWeOffer.subheading}
            </p>

            <!-- STAR WRAPPER -->
            <div class="relative hidden lg:block h-[800px]">
                <!-- CENTER ICON -->
                <div class="absolute inset-0 flex items-center justify-center">
                    <Image
                        src={import('../../assets/careers/career-middle-man.png')}
                        alt={translations.whatWeOffer.centerIconAlt}
                        class="w-50"
                        loading="lazy"
                        width={200}
                        height={200}
                    />
                </div>

                <!-- TOP -->
                <div
                    class="offer-card absolute top-0 left-1/2 -translate-x-1/2"
                >
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.careerGrowth.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.careerGrowth.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-career-growth.svg')}
                            alt={translations.whatWeOffer.benefits.careerGrowth.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>

                <!-- TOP LEFT -->
                <div class="offer-card absolute top-14 left-24">
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.comprehensive.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.comprehensive.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-health.svg')}
                            alt={translations.whatWeOffer.benefits.comprehensive.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>

                <!-- TOP RIGHT -->
                <div class="offer-card absolute top-14 right-24">
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.workplace.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.workplace.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-tshirt.svg')}
                            alt={translations.whatWeOffer.benefits.workplace.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>

                <!-- BOTTOM LEFT -->
                <div class="offer-card absolute bottom-55 left-24">
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.facilities.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.facilities.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-workplace.svg')}
                            alt={translations.whatWeOffer.benefits.facilities.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>

                <!-- BOTTOM RIGHT -->
                <div class="offer-card absolute bottom-60 right-24">
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.events.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.events.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-vacation.svg')}
                            alt={translations.whatWeOffer.benefits.events.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>

                <!-- BOTTOM -->
                <div
                    class="offer-card absolute left-1/3 -bottom-12 -translate-x-1/2"
                >
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.culture.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.culture.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-work-together.svg')}
                            alt={translations.whatWeOffer.benefits.culture.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>
                <!-- BOTTOM -->
                <div
                    class="offer-card absolute left-2/3 -bottom-12 -translate-x-1/2"
                >
                    <h3 class="text-2xl font-bold leading-tight mb-4">
                        {translations.whatWeOffer.benefits.bonuses.title}
                    </h3>
                    <p class="text-xl leading-tight">
                        {translations.whatWeOffer.benefits.bonuses.description}
                    </p>
                    <div class="flex justify-end mt-6">
                        <Image
                            src={import('../../assets/careers/benefit-work-together.svg')}
                            alt={translations.whatWeOffer.benefits.bonuses.iconAlt}
                            class="w-12"
                            loading="lazy"
                            width={48}
                            height={48}
                        />
                    </div>
                </div>
            </div>

            <!-- MOBILE STACK -->
            <div class="lg:hidden space-y-4 px-4">
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">
                        {translations.whatWeOffer.benefits.comprehensive.title}
                    </h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.comprehensive.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">
                        {translations.whatWeOffer.benefits.careerGrowth.title}
                    </h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.careerGrowth.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">{translations.whatWeOffer.benefits.workplace.title}</h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.workplace.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">
                        {translations.whatWeOffer.benefits.facilities.title}
                    </h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.facilities.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">{translations.whatWeOffer.benefits.events.title}</h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.events.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">{translations.whatWeOffer.benefits.bonuses.title}</h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.bonuses.description}
                    </p>
                </div>
                <div class="offer-card-mobile">
                    <h3 class="text-lg font-bold mb-3">
                        {translations.whatWeOffer.benefits.culture.title}
                    </h3>
                    <p class="text-sm leading-relaxed">
                        {translations.whatWeOffer.benefits.culture.description}
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section>
        <!-- TOP INTRO -->
        <div id="positions" class="bg-[#e7eceb] text-center py-12 px-6">
            <div class="max-w-9xl mx-auto">
                <h2 class="text-4xl md:text-7xl font-bold text-[#2b2623] mb-2">
                    {translations.positions.heading}
                </h2>

                <p class="font-semibold text-[#2b2623] mb-3 text-2xl">
                    {translations.positions.subheading}
                </p>

                <p class="text-gray-600 md:text-xl">
                    {translations.positions.description}
                </p>
            </div>
        </div>

        <!-- JOB AREA -->
        <div
            class="relative py-20 overflow-hidden
              bg-gradient-to-r from-[#a8cfca] to-[#86b8ad]"
        >
            <!-- DECORATIVE SHAPES -->
            <div class="absolute inset-0 opacity-30 pointer-events-none">
                <!-- bottom curve -->
                <div
                    class="absolute -left-40 bottom-0
                  w-[600px] h-[300px]
                  bg-[#6aa79b]
                  rounded-full"
                >
                </div>

                <!-- diagonal block -->
                <div
                    class="absolute right-0 top-0
                  w-[500px] h-[400px]
                  bg-[#5f9f93]
                  clip-path-[polygon(30%_0,100%_0,100%_100%,0_100%)]"
                >
                </div>
            </div>

            <!-- JOB LIST -->
            <div class="relative max-w-9xl mx-auto px-6 space-y-6">
                <!-- JOB CARD -->
                <div
                    class="bg-white/40 backdrop-blur-sm
                  flex flex-col md:flex-row
                  md:items-center
                  gap-6
                  p-6 md:p-8
                  rounded"
                >
                    <div class="md:w-[25%]">
                        <h3 class="font-bold text-lg md:text-3xl">{translations.positions.jobs[0].title}</h3>
                        <span class="text-sm md:text-base font-semibold"
                            >{translations.positions.jobs[0].location}</span
                        >
                    </div>

                    <div class="hidden md:block w-[3px] h-20 bg-black"></div>
                    <div class="md:hidden h-[2px] w-full bg-black"></div>

                    <p class="flex-1 text-md md:text-xl text-gray-700">
                        {translations.positions.jobs[0].description}
                    </p>

                    <span
                        class="text-3xl md:text-4xl text-teal-600 font-bold self-end md:self-auto"
                    >
                        →
                    </span>
                </div>

                <!-- JOB CARD -->
                <div
                    class="bg-white/40 backdrop-blur-sm
                  flex flex-col md:flex-row
                  md:items-center
                  gap-6
                  p-6 md:p-8
                  rounded"
                >
                    <div class="md:w-[25%]">
                        <h3 class="font-bold text-lg md:text-3xl">{translations.positions.jobs[1].title}</h3>
                        <span class="text-sm md:text-base font-semibold"
                            >{translations.positions.jobs[1].location}</span
                        >
                    </div>

                    <div class="hidden md:block w-[3px] h-20 bg-black"></div>
                    <div class="md:hidden h-[2px] w-full bg-black"></div>

                    <p class="flex-1 text-md md:text-xl text-gray-700">
                        {translations.positions.jobs[1].description}
                    </p>

                    <span
                        class="text-3xl md:text-4xl text-teal-600 font-bold self-end md:self-auto"
                    >
                        →
                    </span>
                </div>

                <!-- JOB CARD -->
                <div
                    class="bg-white/40 backdrop-blur-sm
                  flex flex-col md:flex-row
                  md:items-center
                  gap-6
                  p-6 md:p-8
                  rounded"
                >
                    <div class="md:w-[25%]">
                        <h3 class="font-bold text-lg md:text-3xl">
                            {translations.positions.jobs[2].title}
                        </h3>
                    </div>

                    <div class="hidden md:block w-[3px] h-20 bg-black"></div>
                    <div class="md:hidden h-[2px] w-full bg-black"></div>

                    <p class="flex-1 text-md md:text-xl text-gray-700">
                        {translations.positions.jobs[2].description}
                    </p>

                    <span
                        class="text-3xl md:text-4xl text-teal-600 font-bold self-end md:self-auto"
                    >
                        →
                    </span>
                </div>
            </div>
        </div>
    </section>

    <section class="bg-[#1c1c1c] text-white py-20">
        <div class="max-w-9xl mx-auto px-6 grid md:grid-cols-2 gap-16 flex">
            <!-- LEFT — APPLY FORM -->
            <div>
                <h2 class="text-5xl md:text-6xl font-bold mb-8">{translations.apply.heading}</h2>

                <div id="formMessage" class="hidden p-4 rounded mb-4"></div>

                <form id="careerForm" class="space-y-6">
                    <!-- Name + Email -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="text-base md:text-lg">{translations.apply.form.name}</label>
                            <input
                                type="text"
                                name="name"
                                id="name"
                                required
                                class="w-full mt-2 bg-[#4b5f59] text-white text-lg px-4 py-3 outline-none"
                            />
                        </div>

                        <div>
                            <label for="email" class="text-base md:text-lg">{translations.apply.form.email}</label>
                            <input
                                type="email"
                                name="email"
                                id="email"
                                required
                                class="w-full mt-2 bg-[#4b5f59] text-white text-lg px-4 py-3 outline-none"
                            />
                        </div>
                    </div>

                    <!-- Position -->
                    <div>
                        <label for="position" class="text-base md:text-lg">{translations.apply.form.position}</label>
                        <input
                            type="text"
                            name="position"
                            id="position"
                            placeholder={translations.apply.form.positionPlaceholder}
                            class="w-full mt-2 bg-[#4b5f59] text-white text-lg px-4 py-3 outline-none placeholder:text-gray-300"
                        />
                    </div>

                    <!-- Cover Letter -->
                    <div>
                        <label for="cover_letter" class="text-base md:text-lg">{translations.apply.form.coverLetter}</label>
                        <textarea
                            rows="4"
                            name="cover_letter"
                            id="cover_letter"
                            class="w-full mt-2 bg-[#4b5f59] text-white text-lg px-4 py-3 outline-none"
                        ></textarea>
                    </div>

                    <!-- Resume -->
                    <div>
                        <label for="resume" class="text-base md:text-lg block mb-2"
                            >{translations.apply.form.resume}</label
                        >
                        <input
                            type="file"
                            name="resume"
                            id="resume"
                            accept=".pdf,.doc,.docx"
                            class="w-full bg-[#4b5f59] text-white text-lg file:bg-gray-200 file:text-black file:px-3 file:py-2 p-2"
                        />
                    </div>

                    <!-- Turnstile Placeholder -->
                    <div
                        class="cf-turnstile"
                        data-sitekey="0x4AAAAAACat4KviYp9cYO3c"
                    >
                    </div>

                    <!-- Submit -->
                    <button
                        type="submit"
                        id="submitBtn"
                        class="bg-gray-200 text-black text-xl px-8 py-3 hover:bg-gray-50 transition rounded disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        {translations.apply.form.submit}
                    </button>
                </form>
            </div>

            <!-- RIGHT — CONTACT -->
            <div>
                <h2 class="text-5xl md:text-6xl font-bold mb-6">{translations.contact.heading}</h2>

                <p
                    class="text-md md:text-xl text-gray-300 leading-relaxed mb-6 max-w-2xl leading-tight"
                >
                    {translations.contact.description}
                </p>

                <a
                    href="/en/contact"
                    class="inline-block bg-gray-200 text-black text-xl px-8 py-3 hover:bg-gray-50 transition rounded"
                    aria-label={translations.contact.buttonAria}
                >
                    {translations.contact.button}
                </a>
            </div>
        </div>
    </section>
    </main>
    <Footer />
</BaseLayout>

<script define:vars={{ translations }}>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('careerForm');
        const submitBtn = document.getElementById('submitBtn');
        const formMessage = document.getElementById('formMessage');

        if (!form || !submitBtn || !formMessage) return;

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = translations.apply.form.submitting;

            // Hide previous messages
            formMessage.classList.add('hidden');

            // Get Turnstile response token
            const turnstileResponse = document.querySelector('[name="cf-turnstile-response"]')?.value;

            if (!turnstileResponse) {
                showMessage(translations.apply.validation.verificationRequired, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = translations.apply.form.submit;
                return;
            }

            // Prepare form data
            const formData = new FormData(form);

            try {
                // Send to API
                const response = await fetch('https://www.qci.com.my/api/career-email.php', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(data.message, 'success');
                    form.reset();
                    // Reset Turnstile
                    if (window.turnstile) {
                        window.turnstile.reset();
                    }
                } else {
                    showMessage(data.message || translations.apply.validation.errorGeneric, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage(translations.apply.validation.submitFailed, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = translations.apply.form.submit;
            }
        });

        function showMessage(message, type) {
            formMessage.textContent = message;
            formMessage.classList.remove('hidden', 'bg-green-500', 'bg-red-500', 'text-white');
            formMessage.classList.add('text-white');
            
            if (type === 'success') {
                formMessage.classList.add('bg-green-500');
            } else {
                formMessage.classList.add('bg-red-500');
            }
            
            formMessage.classList.remove('hidden');
            
            // Scroll to message
            formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    });
</script>

<style>
    .offer-card {
        background: #d8c9a6;
        width: 380px;
        padding: 28px;
        border-radius: 12px;
        text-align: left;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.15);
    }

    .offer-card-mobile {
        background: #d8c9a6;
        padding: 20px;
        border-radius: 8px;
        text-align: left;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #2b2623;
    }
</style>
